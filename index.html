<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Shelf Life Calculator — Day Dots</title>
<style>
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f5f7fa;
    margin: 0;
    color: #222;
  }
  header {
    background: linear-gradient(90deg, #007bff, #00bcd4);
    color: white;
    padding: 16px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  main {
    max-width: 1200px;
    margin: 20px auto;
    padding: 0 10px;
  }
  .category {
    background: white;
    margin-bottom: 24px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
    overflow: hidden;
  }
  .category h2 {
    background: #f0f4f9;
    padding: 12px 16px;
    margin: 0;
    font-size: 18px;
    border-bottom: 1px solid #e2e6ea;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 10px;
    text-align: left;
  }
  th {
    background: #fafafa;
    font-weight: 600;
    font-size: 13px;
    border-bottom: 1px solid #eaeaea;
  }
  tr:nth-child(even) td {
    background: #f9fbfd;
  }
  td img {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    object-fit: cover;
    margin-right: 10px;
    vertical-align: middle;
  }
  .dot {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 6px;
  }
  .red { background:#e74c3c; }
  .green { background:#27ae60; }
  .blue { background:#3498db; }
  .purple { background:#9b59b6; }
  .black { background:#2c3e50; }
  .yellow { background:#f1c40f; }
  .orange { background:#e67e22; }
  .small { font-size:12px; color:#555; }
  input[type="date"], select {
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  .result {
    font-weight: bold;
  }
</style>
</head>
<body>
<header>Shelf Life Calculator — Day Dots</header>
<main id="content">
  <p style="color:#444;margin-bottom:20px;">
    Automatically uses today as open date and applies <strong>Secondary Shelf Life</strong> by default.  
    Each item’s expiry and weekday color dot are calculated automatically.
  </p>
</main>

<script>
async function loadProducts() {
  const response = await fetch('products.json');
  const data = await response.json();
  buildUI(data);
}

function dotColor(day) {
  return ['orange','red','green','blue','purple','black','yellow'][day];
}

function formatDate(d) {
  return d.toISOString().split('T')[0];
}

function addDays(date, days) {
  const result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
}

function addMonths(date, months) {
  const result = new Date(date);
  const day = result.getDate();
  result.setMonth(result.getMonth() + months);
  if (result.getDate() < day) result.setDate(0);
  return result;
}

function buildUI(categories) {
  const container = document.getElementById('content');
  const today = new Date();

  categories.forEach(cat => {
    const card = document.createElement('div');
    card.className = 'category';

    const header = document.createElement('h2');
    header.textContent = cat.category;
    card.appendChild(header);

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    thead.innerHTML = `
      <tr>
        <th>Product</th>
        <th>Storage</th>
        <th>Primary</th>
        <th>Secondary</th>
        <th>Open Date</th>
        <th>Expiry</th>
        <th>Day Dot</th>
      </tr>`;
    table.appendChild(thead);

    const tbody = document.createElement('tbody');

    cat.items.forEach(p => {
      const tr = document.createElement('tr');
      const date = formatDate(today);
      let expiryDate = today;
      if (p.secondaryDays) {
        expiryDate = addDays(today, p.secondaryDays);
      } else if (p.primaryMonths) {
        expiryDate = addMonths(today, p.primaryMonths);
      }
      const expiryStr = formatDate(expiryDate);
      const weekday = expiryDate.getDay();
      const color = dotColor(weekday);
      const label = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'][weekday];

      tr.innerHTML = `
        <td><img src="images/${p.image || 'default.png'}" alt="">${p.name}</td>
        <td class="small">${p.storage || '-'}</td>
        <td>${p.primaryMonths ? p.primaryMonths + ' mo' : '-'}</td>
        <td>${p.secondaryDays ? p.secondaryDays + ' d' : '-'}</td>
        <td>${date}</td>
        <td class="result">${expiryStr}</td>
        <td><span class="dot ${color}" title="${label}"></span><span class="small">${label}</span></td>
      `;
      tbody.appendChild(tr);
    });

    table.appendChild(tbody);
    card.appendChild(table);
    container.appendChild(card);
  });
}

loadProducts();
</script>
</body>
</html>
