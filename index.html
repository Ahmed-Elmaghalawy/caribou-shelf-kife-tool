<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shelf Life Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f5f5f5;
    margin: 20px;
  }
  h2 {
    margin-top: 40px;
    border-bottom: 2px solid #333;
    padding-bottom: 5px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 30px;
  }
  th, td {
    padding: 8px 12px;
    text-align: left;
    vertical-align: middle;
  }
  th {
    background-color: #333;
    color: #fff;
    position: sticky;
    top: 0;
  }
  tr:nth-child(even) {
    background-color: #f0f0f0;
  }
  tr:nth-child(odd) {
    background-color: #ffffff;
  }
  img.product-img {
    width: 40px;
    height: 40px;
    object-fit: cover;
  }
  .day-dot {
    font-size: 16px;
    font-weight: bold;
  }
  input[type="date"], select, button {
    padding: 4px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h1>Shelf Life Tracker</h1>

<div id="products-container"></div>

<script>
  const dayColors = {
    0: 'ðŸŸ ', // Sunday
    1: 'ðŸ”´', // Monday
    2: 'ðŸŸ¢', // Tuesday
    3: 'ðŸ”µ', // Wednesday
    4: 'ðŸŸ£', // Thursday
    5: 'âš«', // Friday
    6: 'ðŸŸ¡'  // Saturday
  };

  const days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

  function calculateExpiry(openDate, type, product) {
    const date = new Date(openDate);
    if(type === "Primary" && product.primaryMonths != null) {
      date.setMonth(date.getMonth() + product.primaryMonths);
    } else if(type === "Secondary" && product.secondaryDays != null) {
      date.setDate(date.getDate() + product.secondaryDays);
    }
    return date;
  }

  function formatDate(date) {
    return date.toISOString().split('T')[0];
  }

  function createProductRow(product) {
    const tr = document.createElement('tr');

    // Image column
    const tdImg = document.createElement('td');
    const img = document.createElement('img');
    img.src = `images/${product.image}`;
    img.alt = product.name;
    img.className = 'product-img';
    tdImg.appendChild(img);
    tr.appendChild(tdImg);

    // Name column
    const tdName = document.createElement('td');
    tdName.textContent = product.name;
    tr.appendChild(tdName);

    // Storage
    const tdStorage = document.createElement('td');
    tdStorage.textContent = product.storage;
    tr.appendChild(tdStorage);

    // Primary months
    const tdPrimary = document.createElement('td');
    tdPrimary.textContent = product.primaryMonths !== null ? product.primaryMonths : '-';
    tr.appendChild(tdPrimary);

    // Secondary days
    const tdSecondary = document.createElement('td');
    tdSecondary.textContent = product.secondaryDays !== null ? product.secondaryDays : '-';
    tr.appendChild(tdSecondary);

    // Date input
    const tdDate = document.createElement('td');
    const inputDate = document.createElement('input');
    inputDate.type = 'date';
    const today = new Date();
    inputDate.value = formatDate(today);
    tdDate.appendChild(inputDate);
    tr.appendChild(tdDate);

    // Dropdown
    const tdDropdown = document.createElement('td');
    const select = document.createElement('select');
    const optionPrimary = document.createElement('option');
    optionPrimary.value = 'Primary';
    optionPrimary.textContent = 'Primary';
    const optionSecondary = document.createElement('option');
    optionSecondary.value = 'Secondary';
    optionSecondary.textContent = 'Secondary';
    optionSecondary.selected = true;
    select.appendChild(optionPrimary);
    select.appendChild(optionSecondary);
    tdDropdown.appendChild(select);
    tr.appendChild(tdDropdown);

    // Expiry date
    const tdExpiry = document.createElement('td');
    tr.appendChild(tdExpiry);

    // Day dot + text
    const tdDot = document.createElement('td');
    tdDot.className = 'day-dot';
    tr.appendChild(tdDot);

    function updateExpiry() {
      const selectedDate = inputDate.value;
      const selectedType = select.value;
      const expiry = calculateExpiry(selectedDate, selectedType, product);
      tdExpiry.textContent = formatDate(expiry);
      tdDot.textContent = `${dayColors[expiry.getDay()]} ${days[expiry.getDay()]}`;
    }

    updateExpiry();
    inputDate.addEventListener('change', updateExpiry);
    select.addEventListener('change', updateExpiry);

    return tr;
  }

  // Load products.json
  fetch('products.json')
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('products-container');

      Object.keys(data).forEach(category => {
        const categoryHeader = document.createElement('h2');
        categoryHeader.textContent = category;
        container.appendChild(categoryHeader);

        const table = document.createElement('table');

        // Table headers
        const thead = document.createElement('thead');
        const trHead = document.createElement('tr');
        ['Image','Product Name','Storage','Primary (months)','Secondary (days)','Opened / Mfg Date','Shelf Life Type','Expiry Date','Day'].forEach(h => {
          const th = document.createElement('th');
          th.textContent = h;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);
        table.appendChild(thead);

        const tbody = document.createElement('tbody');

        data[category].forEach(product => {
          tbody.appendChild(createProductRow(product));
        });

        table.appendChild(tbody);
        container.appendChild(table);
      });
    })
    .catch(err => console.error('Error loading products.json:', err));
</script>

</body>
</html>
